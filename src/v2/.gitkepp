我重新实现的版本，主要做了以下优化：